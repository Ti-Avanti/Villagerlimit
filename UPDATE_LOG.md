# VillagerLimit 更新公告

## v2.1.1 (2025-12-30) 🎯 经验系统增强版

### 🎉 重大更新

#### 双模式经验消耗系统
插件现在支持两种经验消耗方式，服主可以根据服务器需求自由选择：

**1. LEVEL 模式（等级消耗）**
- 直接扣除玩家等级
- 简单直观，玩家容易理解
- 适合休闲服务器
- 配置示例：`cost-mode: LEVEL`，`base-cost: 5` = 扣除5级

**2. POINTS 模式（经验值消耗）** ⭐ 新增
- 扣除具体经验值点数
- 精确控制，更加灵活
- 适合硬核服务器
- 配置示例：`cost-mode: POINTS`，`base-cost: 100` = 扣除100点经验

### ✨ 新增功能

1. **经验值精确计算系统**
   - 完整实现Minecraft经验公式
   - 支持跨等级经验扣除
   - 自动重新分配等级和经验条

2. **增强的最低等级保护**
   - LEVEL模式：防止等级低于设定值
   - POINTS模式：防止经验值低于最低等级所需经验
   - 双重保护机制，确保玩家体验

3. **独立的提示消息**
   - LEVEL模式：显示所需等级和当前等级
   - POINTS模式：显示所需经验点和当前经验点
   - 中英文完整翻译

### 🔧 配置更新

```yaml
trade-control:
  exp-cost:
    enabled: true
    # 消耗模式: LEVEL(等级), POINTS(经验值)
    cost-mode: LEVEL  # 或 POINTS
    base-cost: 5      # 等级模式=5级，经验值模式=5点
    
    # 新增：经验值不足提示
    insufficient-points-message: "§c交易需要 {required} 点经验，你当前只有 {current} 点！"
```

### 🐛 Bug修复

1. **修复经验值模式缺少最低等级保护**
   - 问题：POINTS模式下可能扣除到0级以下
   - 修复：添加最低等级经验值计算和检查

2. **优化经验计算逻辑**
   - 修正getTotalExperience()方法
   - 确保经验值计算准确无误

### 📊 性能优化

- 经验计算使用高效算法
- 避免重复计算
- 线程安全的经验操作

### 🎮 使用场景

**LEVEL模式适合**：
- 休闲生存服
- 新手友好服务器
- 简单经济系统

**POINTS模式适合**：
- 硬核生存服
- 精细经济控制
- 高级RPG服务器

### 📝 升级指南

1. 备份现有配置文件
2. 替换插件jar文件
3. 在config.yml中添加 `cost-mode` 配置项
4. 使用 `/vlreload` 重载配置
5. 测试经验消耗是否正常

### ⚠️ 注意事项

- 从2.1.0升级无需清空数据
- 默认使用LEVEL模式，保持向后兼容
- POINTS模式消耗值建议设置较大（如100-500点）
- 建议先在测试服测试后再应用到正式服

### 🔗 相关链接

- 完整文档：查看 FORUM_POST.md
- 配置示例：查看 config.yml
- 问题反馈：联系作者 Ti_Avanti

---

**下载地址**：`target/Villagerlimit-2.1.1.jar`

感谢使用 VillagerLimit！
